# System Architecture Diagram

This document contains ASCII art diagrams showing the CreatorDirect system architecture.

## High-Level System Overview

```
┌─────────────────────────────────────────────────────────────────────────┐
│                                                                          │
│                          CreatorDirect System                            │
│                                                                          │
│  ┌─────────────────────────────────────────────────────────────────┐   │
│  │                         Frontend Layer                           │   │
│  │                                                                   │   │
│  │   ┌──────────────┐    ┌──────────────┐    ┌──────────────┐     │   │
│  │   │   Wallet     │    │  Contract    │    │ Subscription │     │   │
│  │   │ Connection   │───▶│ Interaction  │───▶│   Status     │     │   │
│  │   │              │    │              │    │   Display    │     │   │
│  │   │ Polkadot.js  │    │ ContractAPI  │    │  Countdown   │     │   │
│  │   └──────────────┘    └──────────────┘    └──────────────┘     │   │
│  │         │                     │                    │             │   │
│  └─────────┼─────────────────────┼────────────────────┼─────────────┘   │
│            │                     │                    │                 │
│            └─────────────────────┼────────────────────┘                 │
│                                  │                                      │
│                                  ▼                                      │
│  ┌─────────────────────────────────────────────────────────────────┐   │
│  │                      Polkadot.js API Layer                       │   │
│  │                                                                   │   │
│  │   ┌─────────────────┐          ┌──────────────────┐             │   │
│  │   │  Web3 Accounts  │          │  Contract Calls   │             │   │
│  │   │   Management    │          │  & Transactions   │             │   │
│  │   └─────────────────┘          └──────────────────┘             │   │
│  └─────────────────────────────────────────────────────────────────┘   │
│                                  │                                      │
│                                  │ WebSocket (wss://)                  │
│                                  ▼                                      │
│  ┌─────────────────────────────────────────────────────────────────┐   │
│  │                   Astar/Shibuya Blockchain                       │   │
│  │                                                                   │   │
│  │   ┌───────────────────────────────────────────────────────┐     │   │
│  │   │      CreatorDirect Smart Contract (ink!)              │     │   │
│  │   │                                                         │     │   │
│  │   │  ┌─────────────────────────────────────────────────┐  │     │   │
│  │   │  │ Storage:                                         │  │     │   │
│  │   │  │  • creator: AccountId                           │  │     │   │
│  │   │  │  • price_per_period: Balance                    │  │     │   │
│  │   │  │  • period_in_blocks: u32                        │  │     │   │
│  │   │  │  • expiry: Mapping<AccountId, u32>              │  │     │   │
│  │   │  │  • has_pass: Mapping<AccountId, bool>           │  │     │   │
│  │   │  └─────────────────────────────────────────────────┘  │     │   │
│  │   │                                                         │     │   │
│  │   │  ┌─────────────────────────────────────────────────┐  │     │   │
│  │   │  │ Functions:                                       │  │     │   │
│  │   │  │  • subscribe() [payable]                        │  │     │   │
│  │   │  │  • is_active(account)                           │  │     │   │
│  │   │  │  • get_subscription_info(account)               │  │     │   │
│  │   │  │  • withdraw() [creator only]                    │  │     │   │
│  │   │  │  • update_params() [creator only]               │  │     │   │
│  │   │  └─────────────────────────────────────────────────┘  │     │   │
│  │   └───────────────────────────────────────────────────────┘     │   │
│  └─────────────────────────────────────────────────────────────────┘   │
│                                                                          │
└─────────────────────────────────────────────────────────────────────────┘
```

## Subscription Flow Sequence

```
┌──────────┐         ┌──────────┐         ┌──────────┐         ┌──────────┐
│   User   │         │ Frontend │         │Polkadot.js│        │ Contract │
└────┬─────┘         └────┬─────┘         └────┬─────┘         └────┬─────┘
     │                    │                     │                     │
     │ 1. Connect Wallet  │                     │                     │
     ├───────────────────▶│                     │                     │
     │                    │                     │                     │
     │                    │ 2. Get Accounts     │                     │
     │                    ├────────────────────▶│                     │
     │                    │◀────────────────────┤                     │
     │                    │   Account List      │                     │
     │                    │                     │                     │
     │ 3. Set Contract    │                     │                     │
     ├───────────────────▶│                     │                     │
     │                    │                     │                     │
     │                    │ 4. Load Contract    │                     │
     │                    ├────────────────────▶│                     │
     │                    │                     │                     │
     │                    │                     │ 5. Query Info       │
     │                    │                     ├────────────────────▶│
     │                    │                     │◀────────────────────┤
     │                    │◀────────────────────┤  Contract Data      │
     │                    │  Price, Period, etc │                     │
     │                    │                     │                     │
     │ 6. Subscribe       │                     │                     │
     │    (select amount) │                     │                     │
     ├───────────────────▶│                     │                     │
     │                    │                     │                     │
     │                    │ 7. Create TX        │                     │
     │                    ├────────────────────▶│                     │
     │                    │                     │                     │
     │                    │ 8. Sign TX          │                     │
     │                    │◀────────────────────┤                     │
     │◀───────────────────┤                     │                     │
     │  Wallet Popup      │                     │                     │
     ├───────────────────▶│                     │                     │
     │  User Signs        │                     │                     │
     │                    │                     │                     │
     │                    │ 9. Submit TX        │                     │
     │                    ├────────────────────▶│                     │
     │                    │                     │                     │
     │                    │                     │ 10. Execute         │
     │                    │                     │     subscribe()     │
     │                    │                     ├────────────────────▶│
     │                    │                     │                     │
     │                    │                     │                     ├─┐
     │                    │                     │                     │ │11. Calculate
     │                    │                     │                     │ │    periods
     │                    │                     │                     │ │    & update
     │                    │                     │                     │◀┘   expiry
     │                    │                     │                     │
     │                    │                     │◀────────────────────┤
     │                    │                     │  Emit Event         │
     │                    │◀────────────────────┤                     │
     │                    │  TX Success         │                     │
     │◀───────────────────┤                     │                     │
     │  Show Success      │                     │                     │
     │                    │                     │                     │
     │                    │ 12. Query Status    │                     │
     │                    ├────────────────────▶│                     │
     │                    │                     ├────────────────────▶│
     │                    │                     │◀────────────────────┤
     │                    │◀────────────────────┤  Status Data        │
     │◀───────────────────┤  Active + Expiry    │                     │
     │  Display Status    │                     │                     │
     │  & Countdown       │                     │                     │
     │                    │                     │                     │
```

## Data Storage Structure

```
┌─────────────────────────────────────────────────────────────────┐
│                    Contract Storage                              │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│  creator: AccountId                                              │
│  ┌────────────────────────────────────────────────────────┐     │
│  │  5GrwvaEF5zXb26Fz9rcQpDWS57CtERHpNehXCPcNoHGKutQY      │     │
│  └────────────────────────────────────────────────────────┘     │
│                                                                  │
│  price_per_period: Balance                                       │
│  ┌────────────────────────────────────────────────────────┐     │
│  │  1000000000000000000 (1 token in plancks)              │     │
│  └────────────────────────────────────────────────────────┘     │
│                                                                  │
│  period_in_blocks: u32                                           │
│  ┌────────────────────────────────────────────────────────┐     │
│  │  1000 (≈ 3.3 hours on Shibuya)                         │     │
│  └────────────────────────────────────────────────────────┘     │
│                                                                  │
│  expiry: Mapping<AccountId, u32>                                 │
│  ┌────────────────────────────────────────────────────────┐     │
│  │  Subscriber A  →  Block 12695424                        │     │
│  │  Subscriber B  →  Block 12696000                        │     │
│  │  Subscriber C  →  Block 12694500                        │     │
│  └────────────────────────────────────────────────────────┘     │
│                                                                  │
│  has_pass: Mapping<AccountId, bool>                              │
│  ┌────────────────────────────────────────────────────────┐     │
│  │  Subscriber A  →  true                                  │     │
│  │  Subscriber B  →  true                                  │     │
│  │  Subscriber C  →  true                                  │     │
│  └────────────────────────────────────────────────────────┘     │
│                                                                  │
│  name: String                                                    │
│  ┌────────────────────────────────────────────────────────┐     │
│  │  "My Creator Channel"                                   │     │
│  └────────────────────────────────────────────────────────┘     │
│                                                                  │
│  description: String                                             │
│  ┌────────────────────────────────────────────────────────┐     │
│  │  "Premium content access"                               │     │
│  └────────────────────────────────────────────────────────┘     │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

## Network Architecture

```
┌──────────────────────────────────────────────────────────────────┐
│                       Network Topology                            │
└──────────────────────────────────────────────────────────────────┘

┌─────────────┐                            ┌─────────────┐
│   Browser   │                            │   Browser   │
│   (User A)  │                            │   (User B)  │
└──────┬──────┘                            └──────┬──────┘
       │                                          │
       │ wss://rpc.shibuya.astar.network          │
       │                                          │
       └──────────────────┬───────────────────────┘
                          │
                          ▼
              ┌───────────────────────┐
              │   Shibuya RPC Node    │
              │   (Public Endpoint)   │
              └───────────┬───────────┘
                          │
                          ▼
              ┌───────────────────────┐
              │  Shibuya Testnet      │
              │  (Blockchain Network) │
              │                       │
              │  ┌─────────────────┐  │
              │  │ Block #12692424 │  │
              │  │   Validators    │  │
              │  │   Consensus     │  │
              │  └─────────────────┘  │
              │                       │
              │  ┌─────────────────┐  │
              │  │    Contracts    │  │
              │  │     Pallet      │  │
              │  │                 │  │
              │  │ CreatorDirect   │  │
              │  │   Contract      │  │
              │  │   (WASM)        │  │
              │  └─────────────────┘  │
              └───────────────────────┘
```

## Component Interaction Details

```
┌─────────────────────────────────────────────────────────────────┐
│                  Frontend Components                             │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│  ┌────────────────┐      ┌────────────────┐                     │
│  │   App.tsx      │      │  Hooks         │                     │
│  │                │      │                │                     │
│  │  • State Mgmt  │◀────▶│  • useApi      │                     │
│  │  • UI Layout   │      │  • useContract │                     │
│  │  • Events      │      │  • useAccount  │                     │
│  └────────┬───────┘      └────────────────┘                     │
│           │                                                      │
│           ▼                                                      │
│  ┌────────────────┐      ┌────────────────┐                     │
│  │  Components    │      │    Utils       │                     │
│  │                │      │                │                     │
│  │  • ProgressRing│◀────▶│  • formatTime  │                     │
│  │  • StatusCard  │      │  • formatAddr  │                     │
│  │  • ActionBtns  │      │  • calculate   │                     │
│  └────────────────┘      └────────────────┘                     │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
              │                           │
              ▼                           ▼
┌──────────────────────┐      ┌──────────────────────┐
│  @polkadot/api       │      │ @polkadot/extension  │
│  • ApiPromise        │      │ • web3Enable         │
│  • WsProvider        │      │ • web3Accounts       │
│  • ContractPromise   │      │ • web3FromAddress    │
└──────────────────────┘      └──────────────────────┘
```

## Deployment Architecture

```
Development          →     Testnet          →     Production
┌──────────┐              ┌──────────┐              ┌──────────┐
│  Local   │              │ Shibuya  │              │  Astar   │
│  Build   │     Deploy   │ Testnet  │    Deploy    │ Mainnet  │
│          │─────────────▶│          │─────────────▶│          │
│  • cargo │              │  Test    │              │  Live    │
│    build │              │  tokens  │              │  tokens  │
│  • npm   │              │  Free    │              │  Real $  │
│    build │              │          │              │          │
└──────────┘              └──────────┘              └──────────┘
     │                         │                         │
     │                         │                         │
     ▼                         ▼                         ▼
┌──────────┐              ┌──────────┐              ┌──────────┐
│Contract  │              │Contract  │              │Contract  │
│  .wasm   │              │ Address  │              │ Address  │
│  .json   │              │   + UI   │              │   + UI   │
└──────────┘              └──────────┘              └──────────┘
```

For more detailed information, see [ARCHITECTURE.md](../ARCHITECTURE.md).
